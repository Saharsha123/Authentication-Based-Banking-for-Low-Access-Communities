<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="bill-generation.css">
    <title>Dashboard</title>
    <style>
        /* General Styles */
        body {
            font-family: Arial, sans-serif;
            background-color: #f4f4f9;
            color: #333;
            margin: 0;
            padding: 0;
        }

        h1, h2 {
            text-align: center;
            color: #2e3d49;
        }

        /* Container for the dashboard */
        .container {
            width: 80%;
            margin: 0 auto;
            padding: 20px;
            background-color: #fff;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
            border-radius: 8px;
            margin-top: 30px;
        }

        h2 {
            color: #0056b3;
        }

        /* Form Styles */
        form {
            display: flex;
            flex-direction: column;
            max-width: 500px;
            margin: 0 auto;
        }

        label {
            font-size: 16px;
            margin-bottom: 8px;
            color: #555;
        }

        input[type="text"],
        input[type="number"] {
            padding: 10px;
            font-size: 16px;
            margin-bottom: 15px;
            border: 1px solid #ddd;
            border-radius: 4px;
            outline: none;
            transition: all 0.3s ease-in-out;
        }

        input[type="text"]:focus,
        input[type="number"]:focus {
            border-color: #0056b3;
            box-shadow: 0 0 5px rgba(0, 86, 179, 0.5);
        }

        button {
            padding: 10px;
            background-color: #0056b3;
            color: #fff;
            border: none;
            border-radius: 4px;
            font-size: 16px;
            cursor: pointer;
            transition: all 0.3s ease;
            margin-bottom: 10px;
        }

        button:hover {
            background-color: #004494;
        }

        /* Success and Error messages */
        #transactionStatus {
            text-align: center;
            margin-top: 20px;
            font-size: 18px;
        }

        #transactionStatus p {
            font-weight: bold;
        }

        #transactionStatus p.green {
            color: #28a745;
        }

        #transactionStatus p.red {
            color: #dc3545;
        }

        /* Logout Button */
        .logout-btn {
            display: block;
            text-align: center;
            margin-top: 20px;
            padding: 10px;
            background-color: #dc3545;
            color: #fff;
            border: none;
            border-radius: 4px;
            font-size: 16px;
            cursor: pointer;
        }

        .logout-btn:hover {
            background-color: #c82333;
        }

        /* Responsive Design */
        @media (max-width: 768px) {
            .container {
                width: 90%;
                padding: 15px;
            }

            form {
                width: 100%;
            }
        }

        @media (max-width: 480px) {
            body {
                padding: 10px;
            }

            h1 {
                font-size: 24px;
            }

            h2 {
                font-size: 20px;
            }

            input[type="text"],
            input[type="number"] {
                font-size: 14px;
                padding: 8px;
            }

            button {
                font-size: 14px;
                padding: 8px;
            }
            #billGenerationSection {
            margin-top: 20px;
            padding: 15px;
            border: 1px solid #ccc;
            border-radius: 8px;
            background-color: #f9f9f9;
            display: none; /* Initially hidden */
        }
        }
    </style>
</head>

<body>
    <div class="container">
        <h1>Dashboard</h1>
        <h2>Transaction Form</h2>
        <form id="transaction-form">
            <label for="accountHolderName">Account Holder Name</label>
            <input type="text" id="accountHolderName" name="accountHolderName" placeholder="Enter account holder name">

            <label for="accountNumber">Account Number:</label>
            <input type="text" id="accountNumber" placeholder="Enter Account Number" required>

            <label for="ifscCode">IFSC Code:</label>
            <input type="text" id="ifscCode" placeholder="Enter IFSC Code" required>

            <button type="button" id="fetchBalanceBtn">Fetch Balance</button>

            <label for="balance">Account Balance</label>
            <input type="text" id="balance" name="balance" placeholder="Balance will appear here" readonly>

            <label for="amount">Amount (Max ₹15,000):</label>
            <input type="number" id="amount" placeholder="Enter Amount" max="15000" required>

            <button type="button" id="generateOtpBtn">Generate OTP</button>

            <label for="otp">Enter OTP:</label>
            <input type="text" id="otp" placeholder="Enter OTP" required>

            <button type="submit">Submit Transaction</button>
            
            <!-- Button to redirect to bill generation page -->
            <br><br>
            <button type="button" id="generateBillBtn">Generate Bill</button>

        </form>

        <div id="transactionStatus"></div>

      

        <!-- Logout Button -->
        <form method="GET" action="/logout">
            <button type="submit" class="logout-btn">Logout</button>
        </form>
    </div>

    <script>
             document.getElementById('fetchBalanceBtn').addEventListener('click', function () {
            const accountNumber = document.getElementById('accountNumber').value;

            fetch('/get_balance', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({ accountNumber })
            })
            .then(response => response.json())
            .then(data => {
                if (data.balance !== undefined) {
                    document.getElementById('balance').value = '₹' + data.balance;
                } else {
                    alert(data.error || 'Error fetching balance');
                }
            })
            .catch(err => {
                console.error('Error:', err);
                alert('Error fetching balance');
            });
        });

        document.getElementById('transaction-form').addEventListener('submit', function (e) {
            e.preventDefault();

            const accountNumber = document.getElementById('accountNumber').value;
            const amount = parseFloat(document.getElementById('amount').value);

            fetch('/process_transaction', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({ accountNumber, amount })
            })
            .then(response => response.json())
            .then(data => {
                const statusDiv = document.getElementById('transactionStatus');
                if (data.success) {
                    statusDiv.innerHTML = `<p class="green">${data.success}</p>`;
                    document.getElementById('balance').value = '₹' + (parseFloat(document.getElementById('balance').value.replace('₹', '')) - amount);
                } else {
                    statusDiv.innerHTML = `<p class="red">${data.error}</p>`;
                }
            })
            .catch(err => {
                console.error('Error:', err);
                alert('Transaction failed');
            });
        });
        let generatedOtp = '';

        document.getElementById('generateOtpBtn').addEventListener('click', function () {
    const amount = parseFloat(document.getElementById('amount').value);

    // Check if the amount exceeds ₹15,000
    if (amount > 15000) {
        alert('Transaction amount exceeds the ₹15,000 limit. OTP cannot be generated.');
        return; // Exit the function without generating OTP
    }

    generatedOtp = Math.floor(100000 + Math.random() * 900000); // Generate a random 6-digit OTP
    alert('Your OTP is: ' + generatedOtp); // Display OTP (You can use other methods to show this to the user)
});

        // Transaction submission logic
        document.getElementById('transaction-form').addEventListener('submit', function (e) {
            e.preventDefault();

            const enteredOtp = document.getElementById('otp').value;
            const amount = parseInt(document.getElementById('amount').value);

            const statusDiv = document.getElementById('transactionStatus');

            if (!generatedOtp) {
                statusDiv.innerHTML = '<p class="red">Please generate an OTP before submitting the transaction.</p>';
                return;
            }

            if (enteredOtp == generatedOtp) {
                if (amount <= 15000) {
                    statusDiv.innerHTML = `<p class="green">Transaction Successful! ₹${amount} has been withdrawn.</p>`;
                } else {
                    statusDiv.innerHTML = '<p class="red">Transaction amount exceeds the ₹15,000 limit. Transaction Denied.</p>';
                }
            } else {
                statusDiv.innerHTML = '<p class="red">Invalid OTP. Transaction Denied.</p>';
            }
        });

        document.getElementById('generateBillBtn').addEventListener('click', function () {
    const accountNumber = document.getElementById('accountNumber').value;
    const ifscCode = document.getElementById('ifscCode').value;
    const amount = document.getElementById('amount').value;
    const name = document.getElementById('accountHolderName').value; // Corrected field for name
    const balanceField = document.getElementById('balance').value;
    const newBalance = balanceField ? balanceField.replace('₹', '') : ''; // Remove ₹ symbol if present
    const timestamp = new Date().toLocaleString(); // Current timestamp

    if (!accountNumber || !ifscCode || !amount || !name || !newBalance) {
        alert('Please ensure all fields are filled before generating the bill.');
        return;
    }

    // Redirect to bill generation page with transaction details
    const url = `/bill_generation?accountNumber=${encodeURIComponent(accountNumber)}&ifscCode=${encodeURIComponent(ifscCode)}&amount=${encodeURIComponent(amount)}&name=${encodeURIComponent(name)}&newBalance=${encodeURIComponent(newBalance)}&timestamp=${encodeURIComponent(timestamp)}`;
    window.location.href = url;
});

    </script>

</body>

</html>
        